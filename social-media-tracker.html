<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Media Click Tracker - PodBoost</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="auth-check.js"></script>
    <style>
        .card {
            background: linear-gradient(145deg, #374151, #4b5563);
            border-radius: 10px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .podboost-glow {
            text-shadow: 0 0 10px rgba(30, 144, 255, 0.7);
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- Include Navigation -->
    <div id="navbar"></div>
    
    <div class="container mx-auto px-4 sm:px-6 py-4 sm:py-8">
        <!-- Header -->
        <div class="text-center mb-6 sm:mb-8">
            <h1 class="text-2xl sm:text-4xl font-bold mb-3 sm:mb-4 text-[#1e90ff] podboost-glow">Social Media Click Tracker</h1>
            <p class="text-lg sm:text-xl text-gray-300 px-2">Track real clicks from your social media campaigns to your podcast</p>
            
            <!-- How to Use Guide -->
            <div class="mt-6 p-4 bg-blue-900/20 border border-blue-500/30 rounded-lg text-left max-w-4xl mx-auto">
                <h3 class="text-lg font-semibold text-blue-300 mb-3">How to Use This Tool:</h3>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-sm">
                    <div class="flex items-start">
                        <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">1</span>
                        <div>
                            <p class="font-medium text-blue-200">Generate Tracking Links</p>
                            <p class="text-gray-300">Click "Generate Short Links" to create unique tracking URLs for each platform</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">2</span>
                        <div>
                            <p class="font-medium text-blue-200">Share on Social Media</p>
                            <p class="text-gray-300">Copy the tracking links and use them in your Twitter, Instagram, LinkedIn posts</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">3</span>
                        <div>
                            <p class="font-medium text-blue-200">Monitor Results</p>
                            <p class="text-gray-300">View real-time analytics to see which platforms drive the most podcast listeners</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Platform Overview -->
        <div class="card p-4 sm:p-6 mb-6 sm:mb-8">
            <h2 class="text-xl sm:text-2xl font-semibold mb-4 sm:mb-6 text-[#1e90ff]">Supported Platforms</h2>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 sm:gap-4">
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <div class="w-12 h-12 bg-black rounded-full flex items-center justify-center mb-3 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </div>
                    <h3 class="font-semibold">Twitter/X</h3>
                    <p class="text-sm text-gray-400">Track posts & threads</p>
                </div>
                
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <div class="w-12 h-12 bg-gradient-to-tr from-purple-600 via-pink-500 to-orange-400 rounded-full flex items-center justify-center mb-3 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                    </div>
                    <h3 class="font-semibold">Instagram</h3>
                    <p class="text-sm text-gray-400">Monitor stories & posts</p>
                </div>
                
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center mb-3 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </div>
                    <h3 class="font-semibold">LinkedIn</h3>
                    <p class="text-sm text-gray-400">Professional network</p>
                </div>
                
                <div class="text-center p-4 bg-gray-800/50 rounded-lg">
                    <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center mb-3 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="white">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                    </div>
                    <h3 class="font-semibold">Email</h3>
                    <p class="text-sm text-gray-400">Newsletter clicks</p>
                </div>
            </div>
        </div>

        <!-- Podcast RSS Configuration -->
        <div class="card p-4 sm:p-6 mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-xl font-semibold mb-3 sm:mb-4 text-[#1e90ff]">Podcast RSS Configuration</h2>
            <p class="text-gray-300 mb-3 sm:mb-4 text-sm sm:text-base">Enter your podcast RSS feed URL. We'll automatically detect available platforms (Spotify, Apple Podcasts, etc.) and redirect users to their preferred platform.</p>
            
            <div class="flex flex-col sm:flex-row gap-3 sm:gap-4">
                <input type="url" id="rss-url" placeholder="https://feeds.example.com/your-podcast-rss" 
                       class="flex-1 bg-gray-800 border border-gray-600 rounded px-3 sm:px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-[#1e90ff] focus:border-transparent text-sm sm:text-base">
                <button onclick="updateRssUrl().catch(error => console.log('RSS update failed:', error))" class="bg-[#1e90ff] hover:bg-[#36b4ff] text-white px-4 sm:px-6 py-2 rounded font-semibold text-sm sm:text-base">
                    Configure RSS
                </button>
            </div>
            
            <div id="rss-status" class="mt-3 text-sm"></div>
            
            <!-- Platform Detection Results -->
            <div id="platform-results" class="mt-4 hidden">
                <h3 class="text-sm font-medium text-gray-300 mb-2">Detected Platforms:</h3>
                <div id="detected-platforms" class="flex flex-wrap gap-2"></div>
            </div>
        </div>

        <!-- Tracking Links -->
        <div class="card p-4 sm:p-6 mb-6 sm:mb-8">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 gap-3">
                <h2 class="text-xl sm:text-2xl font-semibold text-[#1e90ff]">Your Tracking Links</h2>
                <div class="flex flex-col sm:flex-row gap-2 sm:space-x-2">
                    <button onclick="generateShortUrls().catch(error => console.log('Generate URLs failed:', error))" class="bg-purple-600 hover:bg-purple-700 text-white px-3 sm:px-4 py-2 rounded font-semibold text-sm">
                        Generate Short Links
                    </button>
                    <button onclick="clearAllLinks()" class="bg-red-600 hover:bg-red-700 text-white px-3 sm:px-4 py-2 rounded font-semibold text-sm">
                        Clear Links
                    </button>
                </div>
            </div>
            <p class="text-gray-300 mb-4">Copy these links to use in your social media posts. Each click is tracked and redirects to your podcast.</p>
            <p class="text-xs text-yellow-400 mb-6">ðŸ”’ Privacy: Links are automatically cleared between sessions to protect user privacy</p>
            
            <div class="grid gap-4">
                <div class="bg-blue-900/20 border border-blue-500/30 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-300 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="mr-2">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        Twitter/X Episode Link
                    </h3>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <input type="text" readonly value="" id="twitter-ep1-link" class="bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm flex-1 text-gray-300">
                            <button onclick="copyToClipboard('twitter-ep1-link')" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm">Copy</button>
                        </div>
                        <div class="flex items-center space-x-2" id="twitter-ep1-short-container" style="display:none;">
                            <input type="text" readonly value="" id="twitter-ep1-short" placeholder="Short URL will appear here" class="bg-purple-900/20 border border-purple-500/30 rounded px-3 py-2 text-sm flex-1 text-purple-200">
                            <button onclick="copyToClipboard('twitter-ep1-short')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm">Copy Short</button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-purple-900/20 border border-purple-500/30 rounded-lg p-4">
                    <h3 class="font-semibold text-purple-300 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="mr-2">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                        Instagram Story Link
                    </h3>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <input type="text" readonly value="" id="instagram-story-link" class="bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm flex-1 text-gray-300">
                            <button onclick="copyToClipboard('instagram-story-link')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm">Copy</button>
                        </div>
                        <div class="flex items-center space-x-2" id="instagram-story-short-container" style="display:none;">
                            <input type="text" readonly value="" id="instagram-story-short" placeholder="Short URL will appear here" class="bg-purple-900/20 border border-purple-500/30 rounded px-3 py-2 text-sm flex-1 text-purple-200">
                            <button onclick="copyToClipboard('instagram-story-short')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm">Copy Short</button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-blue-900/20 border border-blue-600/30 rounded-lg p-4">
                    <h3 class="font-semibold text-blue-400 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="mr-2">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                        LinkedIn Post Link
                    </h3>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <input type="text" readonly value="" id="linkedin-post-link" class="bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm flex-1 text-gray-300">
                            <button onclick="copyToClipboard('linkedin-post-link')" class="bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded text-sm">Copy</button>
                        </div>
                        <div class="flex items-center space-x-2" id="linkedin-post-short-container" style="display:none;">
                            <input type="text" readonly value="" id="linkedin-post-short" placeholder="Short URL will appear here" class="bg-purple-900/20 border border-purple-500/30 rounded px-3 py-2 text-sm flex-1 text-purple-200">
                            <button onclick="copyToClipboard('linkedin-post-short')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm">Copy Short</button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-green-900/20 border border-green-500/30 rounded-lg p-4">
                    <h3 class="font-semibold text-green-300 mb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" class="mr-2">
                            <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                        </svg>
                        Newsletter Link
                    </h3>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <input type="text" readonly value="" id="newsletter-link" class="bg-gray-800 border border-gray-600 rounded px-3 py-2 text-sm flex-1 text-gray-300">
                            <button onclick="copyToClipboard('newsletter-link')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm">Copy</button>
                        </div>
                        <div class="flex items-center space-x-2" id="newsletter-link-short-container" style="display:none;">
                            <input type="text" readonly value="" id="newsletter-link-short" placeholder="Short URL will appear here" class="bg-purple-900/20 border border-purple-500/30 rounded px-3 py-2 text-sm flex-1 text-purple-200">
                            <button onclick="copyToClipboard('newsletter-link-short')" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm">Copy Short</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Analytics Dashboard -->
        <div class="card p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-[#1e90ff] flex items-center">
                Live Analytics Dashboard
                <span class="ml-2 px-2 py-0.5 text-xs font-medium bg-gradient-to-r from-green-600 to-green-400 text-black rounded-full">LIVE</span>
            </h2>
            <p class="text-gray-300 mb-6">Real-time tracking of clicks from all your social media campaigns</p>
            
            <div class="bg-gray-800/50 rounded-lg p-1">
                <iframe src="" width="100%" height="500" frameborder="0" class="rounded-lg" id="analytics-frame"></iframe>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="grid md:grid-cols-3 gap-6 mb-8">
            <div class="card p-6 text-center">
                <div class="text-3xl font-bold text-[#1e90ff] mb-2" id="total-clicks">Loading...</div>
                <div class="text-gray-300">Total Clicks</div>
            </div>
            
            <div class="card p-6 text-center">
                <div class="text-3xl font-bold text-green-400 mb-2" id="active-campaigns">Loading...</div>
                <div class="text-gray-300">Active Campaigns</div>
            </div>
            
            <div class="card p-6 text-center">
                <div class="text-3xl font-bold text-purple-400 mb-2" id="top-campaign">Loading...</div>
                <div class="text-gray-300">Top Campaign</div>
            </div>
        </div>

        <!-- How to Use -->
        <div class="card p-6">
            <h3 class="text-xl font-semibold mb-4 text-[#1e90ff]">How to Use</h3>
            <div class="space-y-4 text-gray-300">
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-[#1e90ff] rounded-full flex items-center justify-center text-white text-sm font-bold mt-0.5">1</div>
                    <div>
                        <h4 class="font-semibold">Copy tracking links</h4>
                        <p class="text-sm">Use the "Copy" buttons above to get your platform-specific tracking links</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-[#1e90ff] rounded-full flex items-center justify-center text-white text-sm font-bold mt-0.5">2</div>
                    <div>
                        <h4 class="font-semibold">Share on social media</h4>
                        <p class="text-sm">Post these links in your social media content instead of direct podcast links</p>
                    </div>
                </div>
                
                <div class="flex items-start space-x-3">
                    <div class="w-6 h-6 bg-[#1e90ff] rounded-full flex items-center justify-center text-white text-sm font-bold mt-0.5">3</div>
                    <div>
                        <h4 class="font-semibold">Track results</h4>
                        <p class="text-sm">Monitor clicks in real-time through the analytics dashboard above</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global error handler for unhandled promise rejections
        window.addEventListener('unhandledrejection', function(event) {
            console.log('Promise rejection handled:', event.reason);
            event.preventDefault(); // Prevent the default behavior
        });

        // Premium access check function
        function checkPremiumAccess(event, url) {
            // For this demo, allow access to social media tracker
            return true;
        }
        
        // Initialize tracking links and analytics
        function populateTrackingLinks() {
            const baseUrl = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
            
            const savedRss = localStorage.getItem('podcastRss');
            
            // Load saved RSS URL
            if (savedRss) {
                document.getElementById('rss-url').value = savedRss;
                updateRssStatus('RSS feed configured', 'success');
                loadDetectedPlatforms();
            }
            
            // Use the same domain and port for tracking links
            document.getElementById('twitter-ep1-link').value = `${baseUrl}/t/twitter-ep1`;
            document.getElementById('instagram-story-link').value = `${baseUrl}/t/instagram-story`;
            document.getElementById('linkedin-post-link').value = `${baseUrl}/t/linkedin-post`;
            document.getElementById('newsletter-link').value = `${baseUrl}/t/newsletter-link`;
            
            document.getElementById('analytics-frame').src = `${baseUrl}/dashboard`;
        }
        
        async function updateRssUrl() {
            const rssInput = document.getElementById('rss-url');
            const rssUrl = rssInput.value.trim();
            
            if (!rssUrl) {
                updateRssStatus('Please enter an RSS feed URL', 'error');
                return;
            }
            
            try {
                new URL(rssUrl); // Validate URL format
                updateRssStatus('Processing RSS feed...', 'info');
                
                // Parse RSS and detect platforms
                const platforms = await parseRssAndDetectPlatforms(rssUrl);
                
                localStorage.setItem('podcastRss', rssUrl);
                localStorage.setItem('detectedPlatforms', JSON.stringify(platforms));
                
                if (platforms.length > 0) {
                    updateRssStatus(`RSS configured! Detected ${platforms.length} platforms`, 'success');
                    displayDetectedPlatforms(platforms);
                } else {
                    updateRssStatus('RSS configured! Platform detection failed - links will redirect to platform chooser', 'success');
                }
                
                // Update click tracker with RSS data
                await updateClickTrackerRss(rssUrl, platforms);
            } catch (e) {
                updateRssStatus('Please enter a valid RSS URL (e.g., https://feeds.example.com/podcast)', 'error');
            }
        }
        
        async function parseRssAndDetectPlatforms(rssUrl) {
            try {
                const baseUrl = window.location.protocol + '//' + window.location.hostname;
                const response = await fetch(`${baseUrl}:5000/api/parse-rss-platforms`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ rss_url: rssUrl })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                return data.platforms || [];
            } catch (error) {
                console.error('RSS parsing error:', error);
                return [{
                    name: 'Generic Podcast',
                    url: rssUrl,
                    icon: 'ðŸŽ§'
                }];
            }
        }
        
        function updateRssStatus(message, type) {
            const statusDiv = document.getElementById('rss-status');
            statusDiv.textContent = message;
            const colorClass = type === 'success' ? 'text-green-400' : 
                              type === 'error' ? 'text-red-400' : 'text-yellow-400';
            statusDiv.className = `mt-3 text-sm ${colorClass}`;
        }
        
        function displayDetectedPlatforms(platforms) {
            const resultsDiv = document.getElementById('platform-results');
            const platformsDiv = document.getElementById('detected-platforms');
            
            platformsDiv.innerHTML = '';
            
            platforms.forEach(platform => {
                const badge = document.createElement('span');
                badge.className = 'px-3 py-1 bg-blue-600/20 border border-blue-500/30 rounded-full text-sm text-blue-300';
                badge.textContent = `${platform.icon || 'ðŸŽ§'} ${platform.name}`;
                platformsDiv.appendChild(badge);
            });
            
            resultsDiv.classList.remove('hidden');
        }
        
        function loadDetectedPlatforms() {
            const savedPlatforms = localStorage.getItem('detectedPlatforms');
            if (savedPlatforms) {
                try {
                    const platforms = JSON.parse(savedPlatforms);
                    displayDetectedPlatforms(platforms);
                } catch (e) {
                    console.error('Error loading saved platforms');
                }
            }
        }
        
        async function updateClickTrackerRss(rssUrl, platforms) {
            try {
                const baseUrl = window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
                const response = await fetch(`${baseUrl}/api/update-rss`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        rss_url: rssUrl,
                        platforms: platforms
                    })
                });
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                console.log('Click tracker RSS update will apply on next server restart');
            }
        }
        
        // Clear all tracking links for privacy
        function clearAllLinks() {
            const campaigns = ['twitter-ep1', 'instagram-story', 'linkedin-post', 'newsletter-link'];
            
            campaigns.forEach(campaign => {
                const shortInput = document.getElementById(`${campaign}-short`);
                const shortContainer = document.getElementById(`${campaign}-short-container`);
                const regularInput = document.getElementById(`${campaign}-link`);
                
                if (shortInput) shortInput.value = '';
                if (shortContainer) shortContainer.style.display = 'none';
                if (regularInput) regularInput.value = '';
            });
            
            console.log('All tracking links cleared for privacy');
        }

        async function generateShortUrls() {
            try {
                clearAllLinks(); // Clear existing links first
                
                const response = await fetch('/api/short-urls/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        campaigns: ['twitter-ep1', 'instagram-story', 'linkedin-post', 'newsletter-link']
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                
                if (data.success) {
                    // Display short URLs
                    const campaigns = ['twitter-ep1', 'instagram-story', 'linkedin-post', 'newsletter-link'];
                    
                    campaigns.forEach(campaign => {
                        const urlData = data.short_urls[campaign];
                        if (urlData) {
                            const shortInput = document.getElementById(`${campaign}-short`);
                            const shortContainer = document.getElementById(`${campaign}-short-container`);
                            const fullInput = document.getElementById(`${campaign}-link`);
                            
                            // Set full tracking URL
                            if (fullInput && urlData.full_url) {
                                fullInput.value = urlData.full_url;
                            }
                            
                            // Set short URL if available
                            if (shortInput && shortContainer && urlData.short_url) {
                                shortInput.value = urlData.short_url;
                                shortContainer.style.display = 'flex';
                            }
                        }
                    });
                    
                    // Update button text to show success
                    const button = document.querySelector('[onclick="generateShortUrls()"]');
                    const originalText = button.textContent;
                    button.textContent = 'âœ“ Short Links Generated';
                    button.classList.remove('bg-purple-600', 'hover:bg-purple-700');
                    button.classList.add('bg-green-600', 'hover:bg-green-700');
                    
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.classList.remove('bg-green-600', 'hover:bg-green-700');
                        button.classList.add('bg-purple-600', 'hover:bg-purple-700');
                    }, 3000);
                } else {
                    console.error('Failed to generate short URLs:', data.error);
                }
            } catch (error) {
                console.error('Error generating short URLs:', error);
            }
        }
        
        // Load existing short URLs on page load
        async function loadExistingShortUrls() {
            try {
                const response = await fetch('/api/short-urls');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const data = await response.json();
                
                if (data.success && Object.keys(data.short_urls).length > 0) {
                    const campaigns = ['twitter-ep1', 'instagram-story', 'linkedin-post', 'newsletter-link'];
                    
                    campaigns.forEach(campaign => {
                        const shortUrl = data.short_urls[campaign]?.short_url;
                        if (shortUrl) {
                            const shortInput = document.getElementById(`${campaign}-short`);
                            const shortContainer = document.getElementById(`${campaign}-short-container`);
                            
                            if (shortInput && shortContainer) {
                                shortInput.value = shortUrl;
                                shortContainer.style.display = 'flex';
                            }
                        }
                    });
                }
            } catch (error) {
                console.log('No existing short URLs found');
            }
        }
        

        
        function copyToClipboard(inputId) {
            const input = document.getElementById(inputId);
            input.select();
            input.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showCopySuccess(inputId);
            } catch (err) {
                navigator.clipboard.writeText(input.value).then(function() {
                    showCopySuccess(inputId);
                }, function() {
                    alert('Failed to copy link');
                });
            }
        }
        
        function showCopySuccess(inputId) {
            const button = document.querySelector(`button[onclick="copyToClipboard('${inputId}')"]`);
            const originalText = button.textContent;
            button.textContent = 'Copied!';
            button.className = button.className.replace(/bg-\w+-\d+/, 'bg-green-600');
            
            setTimeout(() => {
                button.textContent = originalText;
                button.className = button.className.replace(/bg-green-600/, button.className.includes('blue') ? 'bg-blue-600' : button.className.includes('purple') ? 'bg-purple-600' : 'bg-green-600');
            }, 2000);
        }
        
        async function loadQuickStats() {
            try {
                const response = await fetch(`${window.location.protocol}//${window.location.hostname}:8000/dashboard`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                const html = await response.text();
                
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                
                const statCards = doc.querySelectorAll('.stat-number');
                if (statCards.length >= 2) {
                    document.getElementById('total-clicks').textContent = statCards[0].textContent;
                    document.getElementById('active-campaigns').textContent = statCards[1].textContent;
                }
                
                const campaignRows = doc.querySelectorAll('tbody tr');
                if (campaignRows.length > 0) {
                    const topCampaign = campaignRows[0].querySelector('.campaign-name');
                    document.getElementById('top-campaign').textContent = topCampaign ? topCampaign.textContent : 'None yet';
                } else {
                    document.getElementById('top-campaign').textContent = 'None yet';
                }
            } catch (error) {
                document.getElementById('total-clicks').textContent = '0';
                document.getElementById('active-campaigns').textContent = '0';
                document.getElementById('top-campaign').textContent = 'None yet';
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            clearAllLinks(); // Clear links on page load for privacy
            populateTrackingLinks();
            loadQuickStats().catch(error => console.log('Stats loading failed:', error));
            
            // Auto-refresh stats every 30 seconds
            setInterval(() => {
                loadQuickStats().catch(error => console.log('Stats refresh failed:', error));
            }, 30000);
            
            // Auto-refresh dashboard every minute
            setInterval(() => {
                const iframe = document.getElementById('analytics-frame');
                iframe.src = iframe.src;
            }, 60000);
        });
        
        // Clear links when user navigates away for privacy
        window.addEventListener('beforeunload', clearAllLinks);
        window.addEventListener('pagehide', clearAllLinks);
    </script>
    
    <!-- Load Navigation -->
    <script>
        // Load navbar
        fetch('/navbar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('navbar').innerHTML = data;
            })
            .catch(error => console.error('Error loading navbar:', error));
    </script>
</body>
</html>